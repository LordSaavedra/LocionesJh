<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificación de Autenticidad - AROME DE DIEU</title>
    
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Montserrat:wght@200;300;400;500;600&family=Italiana&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Estilos del index -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/cart.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Fondo del index borroso */
        .index-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            filter: brightness(0.4);
            overflow: hidden;
        }

        .index-background .video-showcase {
            width: 100%;
            height: 100vh;
        }

        .index-background .video-container {
            height: 100vh;
        }

        .index-background .video-background {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Overlay oscuro adicional */
        .dark-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 2;
            animation: fadeIn 0.5s ease-out;
        }

        /* Contenedor principal de verificación */
        .verification-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3;
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .verification-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 700px;
            width: 90%;
        }

        .verification-container {
            background: linear-gradient(135deg, #2B2B2B 0%, #3A3A3A 100%);
            border: 2px solid #EFE8DC;
            border-radius: 12px;
            padding: 0;
            text-align: center;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.8);
            max-width: 700px;
            width: 100%;
            position: relative;
            animation: glow 2s ease-in-out infinite alternate;
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            flex-direction: row;
            min-height: 400px;
        }

        .verification-header {
            display: flex;
            align-items: stretch;
            gap: 0;
            margin-bottom: 0;
            height: auto;
            width: 100%;
            min-height: 400px;
        }

        .product-image-section {
            flex-shrink: 0;
            width: 250px;
            height: 100%;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, rgba(239, 232, 220, 0.1) 0%, rgba(239, 232, 220, 0.05) 100%);
            border-radius: 12px 0 0 12px;
            overflow: hidden;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0;
            border: none;
        }

        .product-image-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(239, 232, 220, 0.1) 0%, rgba(239, 232, 220, 0.05) 100%);
            border: none;
            border-radius: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .placeholder-icon {
            font-size: 2.5rem;
            color: #B8B8B8;
            margin-bottom: 0.5rem;
        }

        .placeholder-text {
            font-size: 0.7rem;
            color: #B8B8B8;
            text-align: center;
            line-height: 1.3;
        }

        .verification-info {
            flex: 1;
            text-align: left;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            height: 100%;
            min-height: 400px;
            padding: 2rem;
            background: linear-gradient(135deg, #2B2B2B 0%, #3A3A3A 100%);
            border-radius: 0 12px 12px 0;
        }

        @keyframes glow {
            from { box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8), 0 0 15px rgba(239, 232, 220, 0.1); }
            to { box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8), 0 0 25px rgba(239, 232, 220, 0.2); }
        }

        .verification-icon {
            font-size: 1.6rem;
            color: #EFE8DC;
            margin-bottom: 0.4rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .brand-name {
            font-family: "Times New Roman", serif;
            font-size: 1.2rem;
            color: #EFE8DC;
            margin-bottom: 0.2rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 1.5px;
        }

        .verification-title {
            font-family: "Times New Roman", serif;
            font-size: 0.85rem;
            color: #EFE8DC;
            font-weight: 600;
            margin-bottom: 0.4rem;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .verification-subtitle {
            font-size: 0.6rem;
            color: #B8B8B8;
            margin-bottom: 0.7rem;
            font-weight: 300;
            line-height: 1.2;
        }

        .product-info {
            background: linear-gradient(135deg, rgba(239, 232, 220, 0.1) 0%, rgba(239, 232, 220, 0.05) 100%);
            border: 1px solid rgba(239, 232, 220, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: left;
        }

        .product-header {
            text-align: center;
            margin-bottom: 0.6rem;
            border-bottom: 1px solid rgba(239, 232, 220, 0.2);
            padding-bottom: 0.4rem;
        }

        .product-name {
            font-family: "Times New Roman", serif;
            font-size: 0.8rem;
            font-weight: 600;
            color: #EFE8DC;
            margin-bottom: 0.2rem;
        }

        .product-brand {
            font-size: 0.6rem;
            color: #B8B8B8;
            font-style: italic;
        }

        .product-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.4rem;
            margin-top: 0.4rem;
        }

        .detail-item {
            background: rgba(239, 232, 220, 0.05);
            padding: 0.4rem;
            border-radius: 4px;
            border: 1px solid rgba(239, 232, 220, 0.1);
        }

        .detail-label {
            font-size: 0.55rem;
            color: #B8B8B8;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 0.15rem;
        }

        .detail-value {
            font-size: 0.65rem;
            color: #EFE8DC;
            font-weight: 500;
        }

        .verification-status {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.2) 0%, rgba(40, 167, 69, 0.1) 100%);
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 0.6rem;
            margin: 1rem 0;
            animation: successPulse 2s infinite;
        }

        @keyframes successPulse {
            0%, 100% { border-color: #28a745; }
            50% { border-color: #20c997; }
        }

        .status-icon {
            font-size: 1rem;
            color: #28a745;
            margin-bottom: 0.2rem;
        }

        .status-text {
            font-size: 0.7rem;
            color: #28a745;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .company-footer {
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid rgba(239, 232, 220, 0.2);
        }

        .company-text {
            font-size: 0.55rem;
            color: #B8B8B8;
            line-height: 1.3;
        }

        .company-highlight {
            color: #EFE8DC;
            font-weight: 600;
        }

        /* Contador de redirección */
        .redirect-countdown {
            margin-top: 1rem;
            padding: 0.8rem;
            background: linear-gradient(135deg, rgba(0, 123, 255, 0.1) 0%, rgba(0, 123, 255, 0.05) 100%);
            border: 1px solid rgba(0, 123, 255, 0.3);
            border-radius: 6px;
            text-align: center;
        }

        .countdown-text {
            font-size: 0.65rem;
            color: #007bff;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .countdown-text i {
            font-size: 0.7rem;
            animation: pulse 1.5s infinite;
        }

        #countdownTimer {
            font-weight: 700;
            color: #EFE8DC;
            background: rgba(0, 123, 255, 0.2);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            min-width: 1.5rem;
            display: inline-block;
        }

        /* Animación de salida */
        .fade-out {
            animation: fadeOut 1s ease-out forwards;
        }

        @keyframes fadeOut {
            to { 
                opacity: 0;
                transform: translateY(-30px);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .verification-wrapper {
                max-width: 450px;
            }

            .verification-header {
                flex-direction: column;
                align-items: stretch;
                gap: 0;
                height: auto;
            }

            .product-image-section {
                width: 100%;
                height: 200px;
            }

            .product-image,
            .product-image-placeholder {
                width: 100%;
                height: 100%;
            }

            .placeholder-icon {
                font-size: 2rem;
            }

            .placeholder-text {
                font-size: 0.6rem;
            }

            .verification-info {
                height: auto;
                padding: 1rem;
                text-align: center;
            }

            .verification-container {
                max-width: 100%;
            }

            .brand-name {
                font-size: 1rem;
            }

            .verification-title {
                font-size: 0.75rem;
            }

            .product-details {
                grid-template-columns: 1fr;
            }

            .product-name {
                font-size: 0.7rem;
            }

            .verification-icon {
                font-size: 1.4rem;
            }
        }

        @media (max-width: 480px) {
            .verification-wrapper {
                max-width: 320px;
            }

            .product-image-section {
                width: 140px;
                height: 140px;
            }

            .verification-container {
                padding: 0.6rem;
            }

            .brand-name {
                font-size: 0.9rem;
                letter-spacing: 1px;
            }

            .verification-title {
                font-size: 0.7rem;
            }

            .placeholder-icon {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Fondo del index borroso -->
    <div class="index-background">
        <!-- Navbar -->
        <div id="navbar-container"></div>
        
        <!-- Video Showcase -->
        <section class="video-showcase">
            <div class="video-container">
                <video autoplay loop muted playsinline class="video-background">
                    <source src="VIDEOS/Video1_index.mp4" type="video/mp4">
                </video>
                <div class="video-content">
                    <h2>Aromes De Dieu</h2>
                    <p>L'art du parfum intemporel</p>
                </div>
            </div>
            
            <div class="video-grid">
                <div class="video-item">
                    <video autoplay loop muted playsinline>
                        <source src="VIDEOS/Video2_index.mp4" type="video/mp4">
                    </video>
                    <div class="video-overlay">
                        <h3>Collection Exclusive</h3>
                    </div>
                </div>
                <div class="video-item">
                    <video autoplay loop muted playsinline>
                        <source src="VIDEOS/Video3_Index.mp4" type="video/mp4">
                    </video>
                    <div class="video-overlay">
                        <h3>Essences Précieuses</h3>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Overlay oscuro adicional -->
    <div class="dark-overlay"></div>    <!-- Overlay de verificación -->
    <div class="verification-overlay">
        <div class="verification-wrapper">
            <!-- Contenedor de verificación unificado -->
            <div class="verification-container">
                <!-- Header con imagen y título -->
                <div class="verification-header">
                    <!-- Sección de imagen del producto -->
                    <div class="product-image-section">
                        <img id="productImage" class="product-image" style="display: none;" alt="Producto">
                        <div id="imagePlaceholder" class="product-image-placeholder">
                            <div class="placeholder-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="placeholder-text">
                                Imagen<br>Producto
                            </div>
                        </div>
                    </div>

                    <!-- Información principal -->
                    <div class="verification-info">
                        <!-- Icono de verificación -->
                        <div class="verification-icon">
                            <i class="fas fa-shield-check"></i>
                        </div>

                        <!-- Nombre de la marca -->
                        <h1 class="brand-name">AROME DE DIEU</h1>

                        <!-- Título de verificación -->
                        <h2 class="verification-title">Producto Verificado</h2>
                        <p class="verification-subtitle">Este producto es auténtico y está respaldado por nuestra garantía de calidad</p>

                        <!-- Estado de verificación -->
                        <div class="verification-status">
                            <div class="status-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="status-text">✓ Producto Legítimo</div>
                        </div>

                        <!-- Información del producto -->
                        <div class="product-info">
                            <div class="product-header">
                                <div class="product-name" id="productName">Cargando...</div>
                                <div class="product-brand" id="productBrand">AROME DE DIEU</div>
                            </div>

                            <div class="product-details">
                                <div class="detail-item">
                                    <div class="detail-label">Código QR</div>
                                    <div class="detail-value" id="qrCode">-</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Fecha de Verificación</div>
                                    <div class="detail-value" id="verificationDate">-</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Lote</div>
                                    <div class="detail-value" id="productLote">-</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Estado</div>
                                    <div class="detail-value" style="color: #28a745;">Auténtico</div>
                                </div>
                            </div>
                        </div>

                        <!-- Pie de página de la empresa -->
                        <div class="company-footer">
                            <p class="company-text">
                                Vendido por <span class="company-highlight">AROME DE DIEU</span><br>
                                Garantía de autenticidad y calidad premium
                            </p>
                            <!-- Contador de redirección -->
                            <div class="redirect-countdown" id="redirectCountdown" style="display: none;">
                                <p class="countdown-text">
                                    <i class="fas fa-home"></i>
                                    Redirigiendo a la tienda en <span id="countdownTimer">10</span> segundos...
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cargar scripts del index -->
    <script src="js/cart.js"></script>
    <script src="js/cart-error-fixes.js"></script>
    <script src="js/limpiar-productos-prueba.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/app.js"></script>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/qr-service-fixed.js"></script>

    <script>
        // Cargar navbar en el fondo
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar navbar silenciosamente
            fetch('html/navbar.html')
                .then(response => response.text())
                .then(data => {
                    const navbarContainer = document.getElementById('navbar-container');
                    if (navbarContainer) {
                        navbarContainer.innerHTML = data;
                    }
                })
                .catch(error => {
                    console.log('Navbar no cargada en verificación:', error);
                });
        });

        // Extraer parámetros de la URL
        function getUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                qr: urlParams.get('qr'),
                product: urlParams.get('product')
            };
        }

        // Cargar datos del QR desde Supabase usando QRService
        async function loadQRData(qrId) {
            try {
                console.log('🔍 Buscando QR usando QRService:', qrId);
                
                // Inicializar QRService
                if (typeof window.QRService === 'undefined') {
                    console.log('📝 Inicializando QRService...');
                    const qrService = new QRService();
                    await qrService.initialize();
                    window.QRService = qrService;
                }

                // Obtener información del QR usando QRService
                const qrInfo = await window.QRService.getQRInfo(qrId);
                
                if (!qrInfo) {
                    console.warn('⚠️ QR no encontrado en base de datos');
                    return loadQRDataFromLocalStorage(qrId);
                }

                console.log('✅ Datos QR obtenidos de base de datos:', qrInfo);

                // Registrar el escaneo
                try {
                    await window.QRService.registerScan(qrId, {
                        userAgent: navigator.userAgent,
                        referrer: document.referrer,
                        location: window.location.href,
                        timestamp: new Date().toISOString()
                    });
                    console.log('✅ Escaneo registrado');
                } catch (scanError) {
                    console.warn('⚠️ Error registrando escaneo:', scanError);
                }

                // Transformar datos al formato esperado por la página
                return {
                    id: qrInfo.qr.id,
                    producto: qrInfo.producto?.nombre || 'Producto AROME DE DIEU',
                    marca: qrInfo.producto?.marca || 'AROME DE DIEU',
                    lote: qrInfo.qr.lote || 'Sin especificar',
                    fechaProduccion: qrInfo.qr.fechaProduccion,
                    fechaCreacion: qrInfo.qr.fechaCreacion,
                    imagen: qrInfo.producto?.imagen_url,
                    imageUrl: qrInfo.producto?.imagen_url,
                    precio: qrInfo.producto?.precio,
                    ml: qrInfo.producto?.ml,
                    categoria: qrInfo.producto?.categoria,
                    descripcion: qrInfo.producto?.descripcion,
                    luxury: qrInfo.producto?.luxury,
                    escaneado: true,
                    ultimaVerificacion: new Date().toISOString(),
                    contadorEscaneos: (qrInfo.qr.totalEscaneos || 0) + 1
                };
                
            } catch (error) {
                console.error('❌ Error cargando datos QR usando QRService:', error);
                return loadQRDataFromLocalStorage(qrId);
            }
        }

        // Fallback: Cargar datos del QR desde localStorage
        function loadQRDataFromLocalStorage(qrId) {
            try {
                console.log('🔄 Usando fallback localStorage para QR:', qrId);
                
                if (typeof window.QRService !== 'undefined') {
                    const qrRecord = window.QRService.getQRFromLocalStorage(qrId);
                    if (qrRecord) {
                        return qrRecord;
                    }
                }
                
                const qrHistory = JSON.parse(localStorage.getItem('qrHistory') || '[]');
                const qrRecord = qrHistory.find(qr => qr.id === qrId);
                
                if (qrRecord) {
                    return qrRecord;
                }
                
                // Si no se encuentra en el historial, crear datos mock
                return {
                    id: qrId,
                    producto: 'Producto AROME DE DIEU',
                    marca: 'AROME DE DIEU',
                    lote: 'LOTE-' + Math.random().toString(36).substr(2, 6).toUpperCase(),
                    fechaCreacion: new Date().toISOString(),
                    escaneado: true,
                    ultimaVerificacion: new Date().toISOString()
                };
            } catch (error) {
                console.error('❌ Error cargando datos QR desde localStorage:', error);
                return null;
            }
        }

        // Actualizar datos en la página
        function updateProductInfo(qrData) {
            if (!qrData) return;

            document.getElementById('productName').textContent = qrData.producto || 'Producto AROME DE DIEU';
            document.getElementById('productBrand').textContent = qrData.marca || 'AROME DE DIEU';
            document.getElementById('qrCode').textContent = qrData.id || 'QR-CODE';
            document.getElementById('productLote').textContent = qrData.lote || 'Sin especificar';
            
            // Fecha de verificación actual
            const now = new Date();
            const dateString = now.toLocaleDateString('es-CO', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const timeString = now.toLocaleTimeString('es-CO', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            document.getElementById('verificationDate').textContent = `${dateString} - ${timeString}`;

            // Cargar imagen del producto
            loadProductImage(qrData);

            // Marcar como escaneado en localStorage
            markAsScanned(qrData.id);
        }

        // Cargar imagen del producto
        function loadProductImage(qrData) {
            const productImage = document.getElementById('productImage');
            const imagePlaceholder = document.getElementById('imagePlaceholder');
            
            // Buscar imagen en diferentes posibles ubicaciones
            const possibleImages = [
                qrData.imagen,
                qrData.imageUrl,
                qrData.imagenUrl,
                qrData.productImage,
                // Rutas por defecto basadas en el nombre del producto
                `IMAGENES/${qrData.producto?.replace(/\s+/g, '_')}.jpg`,
                `IMAGENES/${qrData.producto?.replace(/\s+/g, '_')}.png`,
                `IMAGENES/${qrData.producto?.replace(/\s+/g, '_')}.webp`,
                // Rutas genéricas
                'IMAGENES/producto_default.jpg',
                'IMAGENES/default_product.jpg',
                'PARA_ELLAS.png',
                'PARA_ELLOS.png'
            ].filter(Boolean);

            let imageLoaded = false;
            let currentImageIndex = 0;

            function tryLoadImage() {
                if (currentImageIndex >= possibleImages.length || imageLoaded) {
                    return;
                }

                const imageSrc = possibleImages[currentImageIndex];
                const testImage = new Image();
                
                testImage.onload = function() {
                    if (!imageLoaded) {
                        imageLoaded = true;
                        productImage.src = imageSrc;
                        productImage.style.display = 'block';
                        imagePlaceholder.style.display = 'none';
                        console.log('✅ Imagen cargada:', imageSrc);
                    }
                };
                
                testImage.onerror = function() {
                    currentImageIndex++;
                    tryLoadImage();
                };
                
                testImage.src = imageSrc;
            }

            // Iniciar carga de imagen
            tryLoadImage();
            
            // Timeout para mostrar placeholder si no se carga ninguna imagen
            setTimeout(() => {
                if (!imageLoaded) {
                    console.warn('⚠️ No se pudo cargar ninguna imagen del producto');
                    imagePlaceholder.style.display = 'flex';
                    productImage.style.display = 'none';
                }
            }, 2000);
        }

        // Marcar QR como escaneado
        function markAsScanned(qrId) {
            try {
                const qrHistory = JSON.parse(localStorage.getItem('qrHistory') || '[]');
                const qrIndex = qrHistory.findIndex(qr => qr.id === qrId);
                
                if (qrIndex !== -1) {
                    qrHistory[qrIndex].escaneado = true;
                    qrHistory[qrIndex].ultimaVerificacion = new Date().toISOString();
                    qrHistory[qrIndex].contadorEscaneos = (qrHistory[qrIndex].contadorEscaneos || 0) + 1;
                    
                    localStorage.setItem('qrHistory', JSON.stringify(qrHistory));
                }
            } catch (error) {
                console.error('Error marcando QR como escaneado:', error);
            }
        }

        // Función principal de inicialización
        async function init() {
            console.log('🔍 Inicializando verificación QR...');
            
            try {
                const params = getUrlParams();
                console.log('📋 Parámetros URL:', params);
                
                if (params.qr) {
                    // Mostrar estado de carga
                    document.getElementById('productName').textContent = 'Verificando producto...';
                    document.getElementById('productBrand').textContent = 'AROME DE DIEU';
                    
                    const qrData = await loadQRData(params.qr);
                    console.log('📦 Datos QR cargados:', qrData);
                    
                    if (qrData) {
                        updateProductInfo(qrData);
                        console.log('✅ Verificación QR completada');
                    } else {
                        // Mostrar error si no se encontró el QR
                        showQRError('QR no encontrado o inválido');
                    }
                } else {
                    console.warn('⚠️ No se encontró ID de QR en la URL');
                    // Mostrar datos genéricos
                    updateProductInfo({
                        id: 'QR-GENERICO',
                        producto: 'Producto AROME DE DIEU',
                        marca: 'AROME DE DIEU',
                        lote: 'DEMO-001'
                    });
                }
                
            } catch (error) {
                console.error('❌ Error en inicialización:', error);
                showQRError('Error verificando el producto');
            }
            
            // Mostrar contador de redirección después de 3 segundos
            setTimeout(() => {
                showRedirectCountdown();
            }, 3000);
        }

        // Mostrar error de QR
        function showQRError(message) {
            document.getElementById('productName').textContent = message;
            document.querySelector('.verification-title').textContent = 'Error de Verificación';
            document.querySelector('.verification-subtitle').textContent = 'No se pudo verificar la autenticidad del producto';
            
            // Cambiar el estado de verificación a error
            const statusElement = document.querySelector('.verification-status');
            const statusIcon = statusElement.querySelector('.status-icon i');
            const statusText = statusElement.querySelector('.status-text');
            
            statusElement.style.background = 'linear-gradient(135deg, rgba(220, 53, 69, 0.2) 0%, rgba(220, 53, 69, 0.1) 100%)';
            statusElement.style.borderColor = '#dc3545';
            statusIcon.className = 'fas fa-exclamation-circle';
            statusIcon.style.color = '#dc3545';
            statusText.textContent = '⚠ Error de Verificación';
            statusText.style.color = '#dc3545';
        }

        // Función para mostrar y manejar el contador de redirección
        function showRedirectCountdown() {
            const countdownElement = document.getElementById('redirectCountdown');
            const timerElement = document.getElementById('countdownTimer');
            
            if (countdownElement && timerElement) {
                countdownElement.style.display = 'block';
                
                let countdown = 7; // 7 segundos restantes (ya pasaron 3)
                timerElement.textContent = countdown;
                
                // Actualizar contador cada segundo
                const countdownInterval = setInterval(() => {
                    countdown--;
                    timerElement.textContent = countdown;
                    
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        redirectToIndex();
                    }
                }, 1000);
            }
        }

        // Función para redirigir al index con efecto
        function redirectToIndex() {
            console.log('🔄 Redirigiendo al index...');
            
            // Añadir efecto de fade out antes de redirigir
            const verificationOverlay = document.querySelector('.verification-overlay');
            if (verificationOverlay) {
                verificationOverlay.classList.add('fade-out');
            }
            
            // Redirigir después del efecto de fade
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1000);
        }

        // Manejar errores globales
        window.addEventListener('error', (e) => {
            console.error('Error en verificación QR:', e.error);
        });

        // Inicializar cuando el DOM esté listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
