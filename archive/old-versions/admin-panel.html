<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Aromes De Dieu</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Montserrat:wght@200;300;400;500;600&family=Italiana&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Admin Panel CSS -->
    <link rel="stylesheet" href="css/admin-panel.css">
    
    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
            --color-beige: #E5E5DC;
            --color-gold: #B8860B;
            --color-gold-light: #D4AF37;
            --color-text: #1A1A1A;
            --color-text-light: #4A4A4A;
            --font-serif: 'Cormorant Garamond', serif;
            --font-sans: 'Montserrat', sans-serif;
            --font-display: 'Italiana', serif;
            --spacing-section: 4rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--color-cream);
            color: var(--color-text);
            font-family: var(--font-sans);
            line-height: 1.6;
            min-height: 100vh;
        }

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 4rem;
            background-color: #1A1A1A;
            padding: 3rem 2rem;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-family: var(--font-display);
            font-size: 3.5rem;
            margin-bottom: 1rem;
            color: var(--color-cream);
            letter-spacing: 2px;
        }

        .header .subtitle {
            font-family: var(--font-serif);
            font-style: italic;
            font-size: 1.2rem;
            color: var(--color-beige);
        }

        .admin-grid {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 2rem;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .admin-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
        }

        .sidebar {
            background: #fff;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            border: 1px solid rgba(184,134,11,0.1);
            position: sticky;
            top: 2rem;
        }

        .sidebar h3 {
            font-family: var(--font-serif);
            color: var(--color-text);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 0.5rem;
            background: transparent;
            border: none;
            width: 100%;
            text-align: left;
            font-family: var(--font-sans);
            font-size: 0.95rem;
            color: var(--color-text);
        }

        .menu-item:hover {
            background: rgba(184,134,11,0.1);
            color: var(--color-gold);
            transform: translateX(5px);
        }

        .menu-item.active {
            background: linear-gradient(135deg, var(--color-gold) 0%, var(--color-gold-light) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(184,134,11,0.3);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
        }

        .main-content {
            background: #fff;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            border: 1px solid rgba(184,134,11,0.1);
            min-height: 600px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-family: var(--font-serif);
            font-size: 2rem;
            color: var(--color-text);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--color-text);
            font-family: var(--font-sans);
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid rgba(184,134,11,0.2);
            border-radius: 8px;
            font-size: 1rem;
            font-family: var(--font-sans);
            transition: all 0.3s ease;
            background: #fff;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-gold);
            box-shadow: 0 0 0 3px rgba(184,134,11,0.1);
        }

        .form-control:hover {
            border-color: var(--color-gold-light);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-family: var(--font-sans);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-gold) 0%, var(--color-gold-light) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(184,134,11,0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(184,134,11,0.4);
        }

        .btn-secondary {
            background: #fff;
            color: var(--color-text);
            border: 2px solid rgba(184,134,11,0.2);
        }

        .btn-secondary:hover {
            background: var(--color-cream);
            border-color: var(--color-gold);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .product-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(184,134,11,0.1);
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 48px rgba(0,0,0,0.12);
            border-color: var(--color-gold);
        }

        .product-image {
            position: relative;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--color-cream) 0%, #fff 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            overflow: hidden;
        }

        .product-image img {
            max-width: 100%;
            max-height: 150px;
            object-fit: contain;
            transition: transform 0.4s ease;
            filter: drop-shadow(0 4px 12px rgba(0,0,0,0.1));
        }

        .product-card:hover .product-image img {
            transform: scale(1.05);
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-name {
            font-family: var(--font-serif);
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .product-brand {
            font-family: var(--font-sans);
            font-size: 0.9rem;
            color: var(--color-gold);
            font-weight: 500;
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .product-price {
            font-family: var(--font-sans);
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 1rem;
        }

        .product-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #fff;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            border: 1px solid rgba(184,134,11,0.1);
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.12);
        }

        .stat-icon {
            font-size: 3rem;
            color: var(--color-gold);
            margin-bottom: 1rem;
        }

        .stat-number {
            font-family: var(--font-serif);
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-family: var(--font-sans);
            color: var(--color-text-light);
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .alert {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
            border: 1px solid rgba(46, 204, 113, 0.2);
        }

        .alert-error {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.2);
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            color: var(--color-text-light);
        }

        .loading i {
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .admin-container {
                padding: 1rem;
            }
            
            .header {
                padding: 2rem 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .main-content,
            .sidebar {
                padding: 1.5rem;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
            width: 100%;
            text-align: left;
            font-size: 16px;
            color: #2c3e50;
        }

        .menu-item:hover {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: translateX(5px);
        }

        .menu-item.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
        }

        .status-card {
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid;
            backdrop-filter: blur(10px);
        }

        .status-success {
            background: rgba(46, 204, 113, 0.1);
            border-color: #27ae60;
            color: #27ae60;
        }

        .status-error {
            background: rgba(231, 76, 60, 0.1);
            border-color: #e74c3c;
            color: #e74c3c;
        }

        .status-warning {
            background: rgba(243, 156, 18, 0.1);
            border-color: #f39c12;
            color: #f39c12;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .product-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .product-card .brand {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .product-card .price {
            color: #27ae60;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .product-actions .btn {
            padding: 8px 16px;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .stat-card .icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #667eea;
        }

        .spinner {
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="admin-container">        <!-- Header -->
        <div class="header">
            <h1>Panel de Administración</h1>
            <p class="subtitle">Gestiona tu catálogo de perfumes con elegancia</p>
        </div>

        <!-- Admin Grid -->
        <div class="admin-grid">
            <!-- Sidebar -->            <div class="sidebar">
                <h3><i class="fas fa-cog"></i> Administración</h3>
                
                <button class="menu-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-chart-line"></i>
                    Dashboard
                </button>
                
                <button class="menu-item" onclick="showSection('add-product')">
                    <i class="fas fa-plus-circle"></i>
                    Agregar Producto
                </button>
                
                <button class="menu-item" onclick="showSection('products-list')">
                    <i class="fas fa-box-open"></i>
                    Gestionar Productos
                </button>
                
                <button class="menu-item" onclick="showSection('bulk-import')">
                    <i class="fas fa-upload"></i>
                    Importación Masiva
                </button>
                
                <button class="menu-item" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i>
                    Configuración
                </button>

                <hr style="margin: 20px 0; border: none; height: 1px; background: #e0e0e0;">
                
                <button class="menu-item" onclick="window.open('index.html', '_blank')">
                    <i class="fas fa-external-link-alt"></i>
                    Ver Tienda
                </button>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Status -->
                <div id="status-container"></div>

                <!-- Dashboard -->
                <div id="dashboard" class="content-section active">
                    <h2><i class="fas fa-chart-line"></i> Dashboard</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="icon"><i class="fas fa-box"></i></div>
                            <div class="number" id="total-products">-</div>
                            <div class="label">Total Productos</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="icon"><i class="fas fa-tags"></i></div>
                            <div class="number" id="total-categories">-</div>
                            <div class="label">Categorías</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="icon"><i class="fas fa-star"></i></div>
                            <div class="number" id="total-brands">-</div>
                            <div class="label">Marcas</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="icon"><i class="fas fa-dollar-sign"></i></div>
                            <div class="number" id="avg-price">-</div>
                            <div class="label">Precio Promedio</div>
                        </div>
                    </div>

                    <div style="margin-top: 30px;">
                        <h3>Acciones Rápidas</h3>
                        <div style="display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap;">
                            <button class="btn" onclick="showSection('add-product')">
                                <i class="fas fa-plus"></i> Agregar Producto
                            </button>
                            <button class="btn btn-secondary" onclick="loadDashboardStats()">
                                <i class="fas fa-sync"></i> Actualizar Stats
                            </button>
                            <button class="btn btn-success" onclick="showSection('bulk-import')">
                                <i class="fas fa-upload"></i> Importar Productos
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Add Product -->
                <div id="add-product" class="content-section">
                    <h2><i class="fas fa-plus-circle"></i> Agregar Nuevo Producto</h2>
                    
                    <form id="product-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="nombre"><i class="fas fa-spray-can"></i> Nombre del Producto *</label>
                                <input type="text" id="nombre" required placeholder="Ej: Chanel N°5">
                            </div>
                            
                            <div class="form-group">
                                <label for="marca"><i class="fas fa-trademark"></i> Marca *</label>
                                <input type="text" id="marca" required placeholder="Ej: Chanel">
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="categoria"><i class="fas fa-tags"></i> Categoría *</label>
                                <select id="categoria" required>
                                    <option value="">Seleccionar categoría</option>
                                    <option value="para-ellos">Para Ellos</option>
                                    <option value="para-ellas">Para Ellas</option>
                                    <option value="unisex">Unisex</option>
                                    <option value="clasicas">Clásicas</option>
                                    <option value="vintage">Vintage</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="precio"><i class="fas fa-dollar-sign"></i> Precio (COP) *</label>
                                <input type="number" id="precio" required placeholder="89000" min="0" step="1000">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="imagen"><i class="fas fa-image"></i> URL/Ruta de la Imagen</label>
                            <input type="text" id="imagen" placeholder="IMAGENES/producto.jpg">
                        </div>
                        
                        <div class="form-group">
                            <label for="descripcion"><i class="fas fa-align-left"></i> Descripción</label>
                            <textarea id="descripcion" placeholder="Descripción detallada del producto..."></textarea>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 30px;">
                            <button type="submit" class="btn">
                                <i class="fas fa-save"></i> Guardar Producto
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="clearForm()">
                                <i class="fas fa-eraser"></i> Limpiar Formulario
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Products List -->
                <div id="products-list" class="content-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2><i class="fas fa-box-open"></i> Gestionar Productos</h2>
                        <button class="btn" onclick="loadProducts()">
                            <i class="fas fa-sync"></i> Actualizar Lista
                        </button>
                    </div>
                    
                    <div id="products-container">
                        <div class="loading">
                            <div class="spinner"></div>
                            Cargando productos...
                        </div>
                    </div>
                </div>

                <!-- Bulk Import -->
                <div id="bulk-import" class="content-section">
                    <h2><i class="fas fa-upload"></i> Importación Masiva</h2>
                    
                    <div style="margin-bottom: 30px;">
                        <h3>Cargar Productos Base</h3>
                        <p style="color: #7f8c8d; margin-bottom: 20px;">
                            Carga automáticamente 5 productos de ejemplo basados en tu catálogo actual.
                        </p>
                        <button class="btn btn-success" onclick="loadBaseProducts()">
                            <i class="fas fa-magic"></i> Cargar Productos Base
                        </button>
                    </div>

                    <div>
                        <h3>Eliminar Todos los Productos</h3>
                        <p style="color: #e74c3c; margin-bottom: 20px;">
                            ⚠️ Esta acción eliminará permanentemente todos los productos de la base de datos.
                        </p>
                        <button class="btn btn-danger" onclick="clearAllProducts()">
                            <i class="fas fa-trash"></i> Eliminar Todos
                        </button>
                    </div>
                </div>

                <!-- Settings -->
                <div id="settings" class="content-section">
                    <h2><i class="fas fa-cog"></i> Configuración</h2>
                    
                    <div style="margin-bottom: 30px;">
                        <h3>Estado de la Conexión</h3>
                        <div id="connection-status" class="loading">
                            <div class="spinner"></div>
                            Verificando conexión...
                        </div>
                    </div>

                    <div>
                        <h3>Enlaces Útiles</h3>
                        <div style="display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="window.open('https://supabase.com/dashboard/project/xelobsbzytdxrrxgmlta/editor', '_blank')">
                                <i class="fas fa-database"></i> Panel de Supabase
                            </button>
                            <button class="btn btn-secondary" onclick="window.open('https://supabase.com/dashboard/project/xelobsbzytdxrrxgmlta/sql', '_blank')">
                                <i class="fas fa-code"></i> SQL Editor
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/supabase-config.js"></script>
    <script>
        // Cliente Supabase
        const supabase = window.supabase.createClient(
            'https://xelobsbzytdxrrxgmlta.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhlbG9ic2J6eXRkeHJyeGdtbHRhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzODUzNTksImV4cCI6MjA2NTk2MTM1OX0.bJL5DsL4pxlQ_FV3jX0ieiW3bYLA-Zf3M2HlNmdMMy4'
        );

        // Variables globales
        let currentProducts = [];

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            checkConnection();
            loadDashboardStats();
            setupProductForm();
        });

        // Mostrar sección
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remover active de menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Mostrar sección seleccionada
            document.getElementById(sectionId).classList.add('active');
            
            // Activar menu item
            event.target.closest('.menu-item').classList.add('active');
            
            // Cargar datos específicos de la sección
            if (sectionId === 'products-list') {
                loadProducts();
            } else if (sectionId === 'dashboard') {
                loadDashboardStats();
            } else if (sectionId === 'settings') {
                checkConnection();
            }
        }

        // Mostrar status
        function showStatus(message, type = 'success') {
            const container = document.getElementById('status-container');
            container.innerHTML = `
                <div class="status-card status-${type}">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}"></i>
                    ${message}
                </div>
            `;
            
            // Auto-hide después de 5 segundos
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        // Verificar conexión
        async function checkConnection() {
            const statusEl = document.getElementById('connection-status');
            
            try {
                const { data, error } = await supabase
                    .from('productos')
                    .select('count')
                    .limit(1);

                if (error) {
                    statusEl.innerHTML = `
                        <div class="status-card status-error">
                            <i class="fas fa-times-circle"></i>
                            Error de conexión: ${error.message}
                        </div>
                    `;
                } else {
                    statusEl.innerHTML = `
                        <div class="status-card status-success">
                            <i class="fas fa-check-circle"></i>
                            Conexión exitosa a Supabase
                        </div>
                    `;
                }
            } catch (err) {
                statusEl.innerHTML = `
                    <div class="status-card status-error">
                        <i class="fas fa-times-circle"></i>
                        Error: ${err.message}
                    </div>
                `;
            }
        }

        // Cargar estadísticas del dashboard
        async function loadDashboardStats() {
            try {
                const { data: productos, error } = await supabase
                    .from('productos')
                    .select('*');

                if (error) throw error;

                // Total productos
                document.getElementById('total-products').textContent = productos.length;

                // Categorías únicas
                const categorias = [...new Set(productos.map(p => p.categoria).filter(Boolean))];
                document.getElementById('total-categories').textContent = categorias.length;

                // Marcas únicas
                const marcas = [...new Set(productos.map(p => p.marca).filter(Boolean))];
                document.getElementById('total-brands').textContent = marcas.length;

                // Precio promedio
                const precios = productos.map(p => p.precio).filter(Boolean);
                const promedio = precios.length > 0 ? precios.reduce((a, b) => a + b) / precios.length : 0;
                document.getElementById('avg-price').textContent = new Intl.NumberFormat('es-CO', {
                    style: 'currency',
                    currency: 'COP'
                }).format(promedio);

            } catch (error) {
                showStatus(`Error cargando estadísticas: ${error.message}`, 'error');
            }
        }

        // Configurar formulario de productos
        function setupProductForm() {
            document.getElementById('product-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                await saveProduct();
            });
        }

        // Guardar producto
        async function saveProduct() {
            const producto = {
                nombre: document.getElementById('nombre').value,
                marca: document.getElementById('marca').value,
                categoria: document.getElementById('categoria').value,
                precio: parseFloat(document.getElementById('precio').value),
                imagen: document.getElementById('imagen').value || null,
                descripcion: document.getElementById('descripcion').value || null
            };

            try {
                const { data, error } = await supabase
                    .from('productos')
                    .insert([producto])
                    .select()
                    .single();

                if (error) throw error;

                showStatus(`Producto "${data.nombre}" guardado correctamente`, 'success');
                clearForm();
                loadDashboardStats();

            } catch (error) {
                showStatus(`Error guardando producto: ${error.message}`, 'error');
            }
        }

        // Limpiar formulario
        function clearForm() {
            document.getElementById('product-form').reset();
        }

        // Cargar productos
        async function loadProducts() {
            const container = document.getElementById('products-container');
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    Cargando productos...
                </div>
            `;

            try {
                const { data: productos, error } = await supabase
                    .from('productos')
                    .select('*')
                    .order('id', { ascending: false });

                if (error) throw error;

                currentProducts = productos;

                if (productos.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="icon"><i class="fas fa-box-open"></i></div>
                            <h3>No hay productos</h3>
                            <p>Comienza agregando tu primer producto</p>
                            <button class="btn" onclick="showSection('add-product')" style="margin-top: 20px;">
                                <i class="fas fa-plus"></i> Agregar Producto
                            </button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `
                    <div class="products-grid">
                        ${productos.map(producto => `
                            <div class="product-card">
                                <h4>${producto.nombre || 'Sin nombre'}</h4>
                                <div class="brand">${producto.marca || 'Sin marca'}</div>
                                <div class="price">${formatPrice(producto.precio)}</div>
                                <p style="color: #7f8c8d; margin-bottom: 15px; font-size: 0.9rem;">
                                    ${producto.descripcion ? (producto.descripcion.substring(0, 100) + '...') : 'Sin descripción'}
                                </p>
                                <div class="product-actions">
                                    <button class="btn btn-secondary" onclick="editProduct(${producto.id})">
                                        <i class="fas fa-edit"></i> Editar
                                    </button>
                                    <button class="btn btn-danger" onclick="deleteProduct(${producto.id})">
                                        <i class="fas fa-trash"></i> Eliminar
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;

            } catch (error) {
                container.innerHTML = `
                    <div class="status-card status-error">
                        <i class="fas fa-exclamation-circle"></i>
                        Error cargando productos: ${error.message}
                    </div>
                `;
            }
        }

        // Formatear precio
        function formatPrice(precio) {
            if (!precio) return 'Precio no definido';
            return new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP'
            }).format(precio);
        }

        // Editar producto
        function editProduct(id) {
            const producto = currentProducts.find(p => p.id === id);
            if (!producto) return;

            // Llenar formulario con datos del producto
            document.getElementById('nombre').value = producto.nombre || '';
            document.getElementById('marca').value = producto.marca || '';
            document.getElementById('categoria').value = producto.categoria || '';
            document.getElementById('precio').value = producto.precio || '';
            document.getElementById('imagen').value = producto.imagen || '';
            document.getElementById('descripcion').value = producto.descripcion || '';

            // Cambiar a la sección de agregar producto
            showSection('add-product');
            
            showStatus('Producto cargado en el formulario para editar', 'warning');
        }

        // Eliminar producto
        async function deleteProduct(id) {
            const producto = currentProducts.find(p => p.id === id);
            if (!producto) return;

            if (!confirm(`¿Estás seguro de eliminar "${producto.nombre}"?`)) {
                return;
            }

            try {
                const { error } = await supabase
                    .from('productos')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                showStatus('Producto eliminado correctamente', 'success');
                loadProducts();
                loadDashboardStats();

            } catch (error) {
                showStatus(`Error eliminando producto: ${error.message}`, 'error');
            }
        }

        // Cargar productos base
        async function loadBaseProducts() {
            const productos = [
                {
                    nombre: '212 Men Carolina Herrera',
                    marca: 'Carolina Herrera',
                    categoria: 'para-ellos',
                    precio: 89000,
                    imagen: 'LOCIONES_PARA _ELLOS/212_CAROLINA_HERRERA.png',
                    descripcion: 'Fragancia fresca y urbana para el hombre moderno que busca distinguirse en cada momento del día.'
                },
                {
                    nombre: 'Versace Eros Blue',
                    marca: 'Versace',
                    categoria: 'para-ellos',
                    precio: 120000,
                    imagen: 'LOCIONES_PARA _ELLOS/VERSACE_EROS_BLUE.png',
                    descripcion: 'Frescura mediterránea con notas aromáticas que evocan la pasión y la intensidad del amor.'
                },
                {
                    nombre: 'One Million Paco Rabanne',
                    marca: 'Paco Rabanne',
                    categoria: 'para-ellos',
                    precio: 110000,
                    imagen: 'LOCIONES_PARA _ELLOS/ONE_MILLON_PACO_RABANE.png',
                    descripcion: 'El aroma del éxito y la seducción, con notas especiadas que definen la masculinidad moderna.'
                },
                {
                    nombre: 'Montblanc Legend Night',
                    marca: 'Montblanc',
                    categoria: 'para-ellos',
                    precio: 95000,
                    imagen: 'LOCIONES_PARA _ELLOS/MONTBLACK_LEGEND_NIGH.png',
                    descripcion: 'Elegancia nocturna y sofisticación para el hombre que conquista la noche con su presencia.'
                },
                {
                    nombre: 'Givenchy Blue Label',
                    marca: 'Givenchy',
                    categoria: 'para-ellos',
                    precio: 85000,
                    imagen: 'LOCIONES_PARA _ELLOS/GIVENCHY_BLUE_LABEL.png',
                    descripcion: 'Frescura azul con carácter masculino, perfecta para el día a día del hombre contemporáneo.'
                }
            ];

            try {
                const { data, error } = await supabase
                    .from('productos')
                    .insert(productos)
                    .select();

                if (error) throw error;

                showStatus(`${data.length} productos base cargados correctamente`, 'success');
                loadDashboardStats();
                if (document.getElementById('products-list').classList.contains('active')) {
                    loadProducts();
                }

            } catch (error) {
                showStatus(`Error cargando productos base: ${error.message}`, 'error');
            }
        }

        // Limpiar todos los productos
        async function clearAllProducts() {
            if (!confirm('⚠️ ¿Estás completamente seguro de eliminar TODOS los productos? Esta acción no se puede deshacer.')) {
                return;
            }

            if (!confirm('¿Realmente quieres proceder? Se eliminarán TODOS los productos permanentemente.')) {
                return;
            }

            try {
                const { error } = await supabase
                    .from('productos')
                    .delete()
                    .neq('id', 0);

                if (error) throw error;

                showStatus('Todos los productos han sido eliminados', 'warning');
                loadDashboardStats();
                if (document.getElementById('products-list').classList.contains('active')) {
                    loadProducts();
                }

            } catch (error) {
                showStatus(`Error eliminando productos: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
