<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico - Eliminaci√≥n de Productos</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #dc3545;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }
        
        .diagnostic-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #dc3545;
        }
        
        .diagnostic-section h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        .test-form {
            background: #ffe6e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
        }
        
        .btn:hover {
            background: #c82333;
        }
        
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-info {
            background: #17a2b8;
        }
        
        .product-card {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .product-card.deleted {
            background: #f8d7da;
            border-color: #f5c6cb;
            opacity: 0.7;
        }
        
        .product-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            margin-right: 15px;
            border: 1px solid #e9ecef;
        }
        
        .product-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .product-info {
            flex: 1;
        }
        
        .product-actions {
            display: flex;
            gap: 10px;
        }
        
        .log-container {
            background: #1e1e1e;
            color: #fff;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            max-height: 350px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log-info { background: rgba(23, 162, 184, 0.2); }
        .log-success { background: rgba(40, 167, 69, 0.2); }
        .log-warning { background: rgba(255, 193, 7, 0.2); }
        .log-error { background: rgba(220, 53, 69, 0.2); }
        
        .status-indicator {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 5px;
            display: inline-block;
        }
        
        .status-ok {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .danger-zone {
            background: #fff5f5;
            border: 2px solid #fc8181;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .counter {
            font-size: 1.5rem;
            font-weight: bold;
            color: #dc3545;
            margin: 10px 0;
        }
        
        .warning-text {
            color: #856404;
            background: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóëÔ∏è Diagn√≥stico de Eliminaci√≥n de Productos</h1>
        
        <div class="warning-text">
            <strong>‚ö†Ô∏è ADVERTENCIA:</strong> Este diagn√≥stico incluye tests que pueden eliminar productos reales de la base de datos. 
            √ösalo solo en un ambiente de desarrollo o con productos de prueba.
        </div>
        
        <div class="diagnostic-section">
            <h3>üìä Estado del Sistema de Eliminaci√≥n</h3>
            <div id="systemStatus">
                Verificando sistema de eliminaci√≥n...
            </div>
        </div>
        
        <div class="diagnostic-section">
            <h3>üì¶ Productos Disponibles para Eliminaci√≥n</h3>
            <button id="loadProducts" class="btn btn-info">üîÑ Cargar Productos</button>
            <button id="createTestProduct" class="btn btn-success">‚ûï Crear Producto de Test</button>
            <div>
                <strong>Total productos:</strong> <span id="totalProducts" class="counter">0</span>
                <strong>Eliminados en esta sesi√≥n:</strong> <span id="deletedCount" class="counter">0</span>
            </div>
            <div id="productsList">
                No se han cargado productos a√∫n...
            </div>
        </div>
        
        <div class="danger-zone">
            <h3>üß™ Tests de Eliminaci√≥n</h3>
            <p><strong>‚ö†Ô∏è ZONA PELIGROSA:</strong> Estos tests eliminar√°n productos reales.</p>
            
            <button id="testNormalDelete" class="btn">üóëÔ∏è Test: Eliminaci√≥n Normal</button>
            <button id="testDoubleDelete" class="btn btn-warning">‚ö° Test: Eliminaci√≥n Doble</button>
            <button id="testConcurrentDelete" class="btn btn-warning">üöÄ Test: Eliminaci√≥n Concurrente</button>
            <button id="testNonExistentDelete" class="btn btn-info">üëª Test: Eliminar No Existente</button>
            <button id="testDeleteMethods" class="btn btn-info">üîß Test: Ambos M√©todos</button>
        </div>
        
        <div class="diagnostic-section">
            <h3>üõ°Ô∏è Tests de Protecci√≥n</h3>
            <button id="testConfirmationDialog" class="btn btn-info">üí¨ Test: Di√°logo de Confirmaci√≥n</button>
            <button id="testErrorHandling" class="btn btn-info">‚ùå Test: Manejo de Errores</button>
            <button id="testNetworkError" class="btn btn-info">üåê Test: Error de Red</button>
            <button id="testValidation" class="btn btn-info">‚úÖ Test: Validaci√≥n</button>
        </div>
        
        <div class="diagnostic-section">
            <h3>üìã Log de Eventos</h3>
            <button id="clearLog" class="btn btn-secondary">üßπ Limpiar Log</button>
            <div id="logContainer" class="log-container">
                <div class="log-entry log-info">üöÄ Sistema de diagn√≥stico de eliminaci√≥n iniciado...</div>
            </div>
        </div>
    </div>

    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Configuraci√≥n y servicios -->
    <script src="js/supabase-config.js"></script>
    <script src="js/admin-panel-new.js"></script>
    
    <script>
        class DeleteDiagnosticSystem {
            constructor() {
                this.products = [];
                this.deletedCount = 0;
                this.logContainer = document.getElementById('logContainer');
                this.isDeletingProduct = false;
                this.deletedProducts = new Set();
                
                this.init();
            }
            
            init() {
                this.log('üöÄ Iniciando sistema de diagn√≥stico de eliminaci√≥n...', 'info');
                this.setupEventListeners();
                this.checkSystemStatus();
            }
            
            setupEventListeners() {
                document.getElementById('loadProducts').addEventListener('click', () => {
                    this.loadProducts();
                });
                
                document.getElementById('createTestProduct').addEventListener('click', () => {
                    this.createTestProduct();
                });
                
                document.getElementById('clearLog').addEventListener('click', () => {
                    this.clearLog();
                });
                
                // Tests de eliminaci√≥n
                document.getElementById('testNormalDelete').addEventListener('click', () => {
                    this.testNormalDelete();
                });
                
                document.getElementById('testDoubleDelete').addEventListener('click', () => {
                    this.testDoubleDelete();
                });
                
                document.getElementById('testConcurrentDelete').addEventListener('click', () => {
                    this.testConcurrentDelete();
                });
                
                document.getElementById('testNonExistentDelete').addEventListener('click', () => {
                    this.testNonExistentDelete();
                });
                
                document.getElementById('testDeleteMethods').addEventListener('click', () => {
                    this.testDeleteMethods();
                });
                
                // Tests de protecci√≥n
                document.getElementById('testConfirmationDialog').addEventListener('click', () => {
                    this.testConfirmationDialog();
                });
                
                document.getElementById('testErrorHandling').addEventListener('click', () => {
                    this.testErrorHandling();
                });
                
                document.getElementById('testNetworkError').addEventListener('click', () => {
                    this.testNetworkError();
                });
                
                document.getElementById('testValidation').addEventListener('click', () => {
                    this.testValidation();
                });
            }
            
            async checkSystemStatus() {
                this.log('üîç Verificando estado del sistema de eliminaci√≥n...', 'info');
                
                const status = {
                    supabase: typeof window.supabase !== 'undefined',
                    adminPanel: typeof AdminPanel !== 'undefined',
                    productosService: typeof ProductosService !== 'undefined',
                    deleteProduct: typeof ProductosService?.deleteProduct === 'function',
                    deleteProductSimple: typeof ProductosService?.deleteProductSimple === 'function'
                };
                
                let statusHtml = '<h4>Estado de Dependencias para Eliminaci√≥n:</h4>';
                
                for (const [key, value] of Object.entries(status)) {
                    const statusClass = value ? 'status-ok' : 'status-error';
                    const statusText = value ? '‚úÖ OK' : '‚ùå ERROR';
                    statusHtml += `<span class="status-indicator ${statusClass}">${key}: ${statusText}</span>`;
                }
                
                // Verificar m√©todos espec√≠ficos de eliminaci√≥n
                if (typeof adminPanel !== 'undefined' && adminPanel) {
                    const deleteMethods = ['deleteProduct', 'showLoading', 'showAlert', 'updateDashboardDisplay'];
                    statusHtml += `<br><br><strong>M√©todos de Eliminaci√≥n en AdminPanel:</strong><br>`;
                    
                    deleteMethods.forEach(method => {
                        const exists = typeof adminPanel[method] === 'function';
                        const statusClass = exists ? 'status-ok' : 'status-error';
                        const statusText = exists ? '‚úÖ' : '‚ùå';
                        statusHtml += `<span class="status-indicator ${statusClass}">${method}: ${statusText}</span>`;
                    });
                }
                
                document.getElementById('systemStatus').innerHTML = statusHtml;
                this.log('üìä Estado del sistema verificado', 'success');
            }
            
            async loadProducts() {
                this.log('üì¶ Cargando productos para eliminaci√≥n...', 'info');
                
                try {
                    if (typeof ProductosService === 'undefined') {
                        throw new Error('ProductosService no disponible');
                    }
                    
                    const products = await ProductosService.obtenerProductos();
                    this.products = products || [];
                    
                    this.log(`‚úÖ Productos cargados: ${this.products.length}`, 'success');
                    this.displayProducts();
                    this.updateCounters();
                    
                } catch (error) {
                    this.log(`‚ùå Error cargando productos: ${error.message}`, 'error');
                    document.getElementById('productsList').innerHTML = 
                        `<div style="color: red;">Error: ${error.message}</div>`;
                }
            }
            
            displayProducts() {
                const container = document.getElementById('productsList');
                
                if (this.products.length === 0) {
                    container.innerHTML = '<div>No hay productos disponibles</div>';
                    return;
                }
                
                let html = `<h4>Productos Disponibles (${this.products.length}):</h4>`;
                
                this.products.slice(0, 15).forEach(product => {
                    const isDeleted = this.deletedProducts.has(product.id);
                    const cardClass = isDeleted ? 'product-card deleted' : 'product-card';
                    
                    const imageHtml = product.imagen_url || product.imagen ? 
                        `<img src="${product.imagen_url || product.imagen}" class="product-image" alt="${product.nombre}" onerror="this.style.display='none'">` : 
                        '<div class="product-image" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 0.8rem;">Sin imagen</div>';
                    
                    const deleteButtonText = isDeleted ? '‚ùå ELIMINADO' : 'üóëÔ∏è Eliminar';
                    const deleteButtonClass = isDeleted ? 'btn btn-secondary' : 'btn';
                    const deleteButtonDisabled = isDeleted ? 'disabled' : '';
                    
                    html += `
                        <div class="${cardClass}">
                            <div class="product-header">
                                ${imageHtml}
                                <div class="product-info">
                                    <strong>${product.nombre}</strong><br>
                                    <small>Marca: ${product.marca} | Precio: $${product.precio?.toLocaleString()} | ID: ${product.id}</small><br>
                                    <small>Estado: ${product.estado || 'N/A'} | Activo: ${product.activo ? 'S√≠' : 'No'}</small>
                                    ${isDeleted ? '<br><small style="color: red;"><strong>ELIMINADO EN ESTA SESI√ìN</strong></small>' : ''}
                                </div>
                                <div class="product-actions">
                                    <button class="${deleteButtonClass}" ${deleteButtonDisabled} onclick="deleteDiagnostic.deleteProduct(${product.id})">
                                        ${deleteButtonText}
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                if (this.products.length > 15) {
                    html += `<div style="text-align: center; margin: 10px;"><small>... y ${this.products.length - 15} productos m√°s</small></div>`;
                }
                
                container.innerHTML = html;
            }
            
            async createTestProduct() {
                this.log('‚ûï Creando producto de test para eliminaci√≥n...', 'info');
                
                try {
                    if (typeof ProductosService === 'undefined') {
                        throw new Error('ProductosService no disponible');
                    }
                    
                    const testProduct = {
                        nombre: `Test Eliminaci√≥n ${Date.now()}`,
                        marca: 'Test Marca',
                        precio: 10000,
                        categoria: 'para-ellos',
                        descripcion: 'Producto creado para test de eliminaci√≥n',
                        activo: true
                    };
                    
                    const result = await ProductosService.crearProducto(testProduct);
                    
                    if (result && result.id) {
                        this.log(`‚úÖ Producto de test creado: ID ${result.id}`, 'success');
                        
                        // Recargar productos
                        await this.loadProducts();
                    } else {
                        this.log('‚ö†Ô∏è Producto creado pero sin ID v√°lido', 'warning');
                    }
                    
                } catch (error) {
                    this.log(`‚ùå Error creando producto de test: ${error.message}`, 'error');
                }
            }
            
            async deleteProduct(productId) {
                if (this.isDeletingProduct) {
                    this.log('‚ö†Ô∏è Ya hay una eliminaci√≥n en progreso, cancelando...', 'warning');
                    return;
                }
                
                const product = this.products.find(p => p.id === productId);
                if (!product) {
                    this.log(`‚ùå Producto ID ${productId} no encontrado`, 'error');
                    return;
                }
                
                if (this.deletedProducts.has(productId)) {
                    this.log(`‚ö†Ô∏è Producto ${product.nombre} ya fue eliminado en esta sesi√≥n`, 'warning');
                    return;
                }
                
                // Simular confirmaci√≥n (sin mostrar prompt real para testing)
                this.log(`üóëÔ∏è Iniciando eliminaci√≥n de producto: ${product.nombre} (ID: ${productId})`, 'warning');
                
                this.isDeletingProduct = true;
                
                try {
                    // Usar AdminPanel si est√° disponible
                    let result;
                    if (typeof adminPanel !== 'undefined' && adminPanel && typeof adminPanel.deleteProduct === 'function') {
                        this.log('üîÑ Usando AdminPanel.deleteProduct...', 'info');
                        
                        // Temporalmente sobrescribir confirm para evitar prompt
                        const originalConfirm = window.confirm;
                        window.confirm = () => true;
                        
                        try {
                            await adminPanel.deleteProduct(productId);
                            result = { success: true };
                        } finally {
                            window.confirm = originalConfirm;
                        }
                        
                    } else if (typeof ProductosService !== 'undefined' && typeof ProductosService.deleteProduct === 'function') {
                        this.log('üîÑ Usando ProductosService.deleteProduct...', 'info');
                        result = await ProductosService.deleteProduct(productId);
                    } else {
                        throw new Error('No hay m√©todo de eliminaci√≥n disponible');
                    }
                    
                    if (result && result.success !== false) {
                        this.log(`‚úÖ Producto "${product.nombre}" eliminado exitosamente`, 'success');
                        this.deletedProducts.add(productId);
                        this.deletedCount++;
                        this.updateCounters();
                        
                        // Actualizar display
                        this.displayProducts();
                        
                    } else {
                        this.log('‚ö†Ô∏è Eliminaci√≥n completada pero sin confirmaci√≥n de √©xito', 'warning');
                    }
                    
                } catch (error) {
                    this.log(`‚ùå Error eliminando producto: ${error.message}`, 'error');
                    console.error('Error completo:', error);
                } finally {
                    this.isDeletingProduct = false;
                }
            }
            
            // Tests espec√≠ficos
            async testNormalDelete() {
                this.log('üß™ Iniciando test de eliminaci√≥n normal...', 'info');
                
                const availableProducts = this.products.filter(p => !this.deletedProducts.has(p.id));
                if (availableProducts.length === 0) {
                    this.log('‚ùå No hay productos disponibles para eliminar', 'error');
                    return;
                }
                
                const testProduct = availableProducts[0];
                this.log(`üìù Probando eliminaci√≥n normal con: ${testProduct.nombre}`, 'info');
                
                await this.deleteProduct(testProduct.id);
                this.log('‚úÖ Test de eliminaci√≥n normal completado', 'success');
            }
            
            async testDoubleDelete() {
                this.log('‚ö° Iniciando test de eliminaci√≥n doble...', 'warning');
                
                const availableProducts = this.products.filter(p => !this.deletedProducts.has(p.id));
                if (availableProducts.length === 0) {
                    this.log('‚ùå No hay productos disponibles para test doble', 'error');
                    return;
                }
                
                const testProduct = availableProducts[0];
                this.log(`üìù Probando eliminaci√≥n doble con: ${testProduct.nombre}`, 'warning');
                
                // Dos eliminaciones r√°pidas del mismo producto
                setTimeout(() => this.deleteProduct(testProduct.id), 0);
                setTimeout(() => this.deleteProduct(testProduct.id), 50);
                
                this.log('‚ö° Test de eliminaci√≥n doble iniciado', 'warning');
            }
            
            async testConcurrentDelete() {
                this.log('üöÄ Iniciando test de eliminaci√≥n concurrente...', 'warning');
                
                const availableProducts = this.products.filter(p => !this.deletedProducts.has(p.id));
                if (availableProducts.length < 3) {
                    this.log('‚ùå Se necesitan al menos 3 productos para test concurrente', 'error');
                    return;
                }
                
                const testProducts = availableProducts.slice(0, 3);
                this.log(`üìù Probando eliminaci√≥n concurrente con 3 productos`, 'warning');
                
                // Eliminar 3 productos simult√°neamente
                testProducts.forEach((product, index) => {
                    setTimeout(() => this.deleteProduct(product.id), index * 25);
                });
                
                this.log('üöÄ Test de eliminaci√≥n concurrente iniciado', 'warning');
            }
            
            async testNonExistentDelete() {
                this.log('üëª Iniciando test de eliminaci√≥n de producto no existente...', 'info');
                
                const fakeId = 999999;
                this.log(`üìù Intentando eliminar producto ID ficticio: ${fakeId}`, 'info');
                
                try {
                    if (typeof ProductosService !== 'undefined' && typeof ProductosService.deleteProduct === 'function') {
                        const result = await ProductosService.deleteProduct(fakeId);
                        this.log(`ü§î Resultado inesperado: ${JSON.stringify(result)}`, 'warning');
                    }
                } catch (error) {
                    this.log(`‚úÖ Error esperado capturado: ${error.message}`, 'success');
                }
                
                this.log('‚úÖ Test de producto no existente completado', 'success');
            }
            
            async testDeleteMethods() {
                this.log('üîß Iniciando test de ambos m√©todos de eliminaci√≥n...', 'info');
                
                const availableProducts = this.products.filter(p => !this.deletedProducts.has(p.id));
                if (availableProducts.length < 2) {
                    this.log('‚ùå Se necesitan al menos 2 productos para test de m√©todos', 'error');
                    return;
                }
                
                const product1 = availableProducts[0];
                const product2 = availableProducts[1];
                
                try {
                    // Test m√©todo principal
                    this.log(`üîÑ Probando m√©todo principal con: ${product1.nombre}`, 'info');
                    if (typeof ProductosService !== 'undefined' && typeof ProductosService.deleteProduct === 'function') {
                        const result1 = await ProductosService.deleteProduct(product1.id);
                        this.log(`‚úÖ M√©todo principal: ${result1?.success ? 'OK' : 'FAIL'}`, result1?.success ? 'success' : 'warning');
                        if (result1?.success) {
                            this.deletedProducts.add(product1.id);
                            this.deletedCount++;
                        }
                    }
                    
                    // Test m√©todo simple
                    this.log(`üîÑ Probando m√©todo simple con: ${product2.nombre}`, 'info');
                    if (typeof ProductosService !== 'undefined' && typeof ProductosService.deleteProductSimple === 'function') {
                        const result2 = await ProductosService.deleteProductSimple(product2.id);
                        this.log(`‚úÖ M√©todo simple: ${result2?.success ? 'OK' : 'FAIL'}`, result2?.success ? 'success' : 'warning');
                        if (result2?.success) {
                            this.deletedProducts.add(product2.id);
                            this.deletedCount++;
                        }
                    }
                    
                    this.updateCounters();
                    this.displayProducts();
                    
                } catch (error) {
                    this.log(`‚ùå Error en test de m√©todos: ${error.message}`, 'error');
                }
                
                this.log('‚úÖ Test de ambos m√©todos completado', 'success');
            }
            
            // Tests de protecci√≥n
            async testConfirmationDialog() {
                this.log('üí¨ Test de di√°logo de confirmaci√≥n...', 'info');
                
                // Verificar que AdminPanel usa confirm()
                if (typeof adminPanel !== 'undefined' && adminPanel) {
                    this.log('‚úÖ AdminPanel disponible - Verificando uso de confirm()', 'success');
                    
                    // En una implementaci√≥n real, verificar√≠amos que se llama confirm()
                    this.log('‚ÑπÔ∏è El di√°logo de confirmaci√≥n debe aparecer antes de cada eliminaci√≥n', 'info');
                    this.log('‚ÑπÔ∏è Verificaci√≥n manual requerida en el panel real', 'info');
                } else {
                    this.log('‚ùå AdminPanel no disponible para test', 'error');
                }
                
                this.log('‚úÖ Test de confirmaci√≥n completado', 'success');
            }
            
            async testErrorHandling() {
                this.log('‚ùå Test de manejo de errores...', 'info');
                
                // Test con Supabase desconectado (simulado)
                this.log('üìù Probando manejo de errores de conexi√≥n...', 'info');
                
                try {
                    // Intentar eliminar con cliente null (simulaci√≥n)
                    this.log('üß™ Simulando error de Supabase no configurado...', 'info');
                    
                    const originalClient = window.supabaseClient;
                    window.supabaseClient = null;
                    
                    try {
                        if (typeof ProductosService !== 'undefined') {
                            await ProductosService.deleteProduct(1);
                        }
                    } catch (error) {
                        this.log(`‚úÖ Error de configuraci√≥n capturado: ${error.message}`, 'success');
                    } finally {
                        window.supabaseClient = originalClient;
                    }
                    
                } catch (error) {
                    this.log(`‚úÖ Manejo de errores funcional: ${error.message}`, 'success');
                }
                
                this.log('‚úÖ Test de manejo de errores completado', 'success');
            }
            
            async testNetworkError() {
                this.log('üåê Test de error de red (simulado)...', 'info');
                this.log('‚ÑπÔ∏è En una implementaci√≥n real, esto requerir√≠a interceptar requests de red', 'info');
                this.log('‚ÑπÔ∏è El sistema debe manejar TimeoutError, NetworkError, etc.', 'info');
                this.log('‚úÖ Test de red completado (simulado)', 'success');
            }
            
            async testValidation() {
                this.log('‚úÖ Test de validaci√≥n de entrada...', 'info');
                
                // Test con ID inv√°lido
                try {
                    await this.deleteProduct(null);
                    await this.deleteProduct(undefined);
                    await this.deleteProduct('invalid-id');
                    await this.deleteProduct(-1);
                } catch (error) {
                    this.log(`‚úÖ Validaci√≥n funcional: ${error.message}`, 'success');
                }
                
                this.log('‚úÖ Test de validaci√≥n completado', 'success');
            }
            
            updateCounters() {
                document.getElementById('totalProducts').textContent = this.products.length;
                document.getElementById('deletedCount').textContent = this.deletedCount;
            }
            
            clearLog() {
                this.logContainer.innerHTML = '<div class="log-entry log-info">üßπ Log limpiado...</div>';
            }
            
            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${type}`;
                logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
                
                this.logContainer.appendChild(logEntry);
                this.logContainer.scrollTop = this.logContainer.scrollHeight;
                
                console.log(`[DELETE-DIAGNOSTIC] ${message}`);
            }
        }
        
        // Inicializar cuando todo est√© listo
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                window.deleteDiagnostic = new DeleteDiagnosticSystem();
            }, 1000);
        });
    </script>
</body>
</html>
